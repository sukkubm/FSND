{% extends 'layouts/main.html' %}
{% block title %}Fyyur | Venues Search{% endblock %}
{% block content %}
<h3>Number of search results for "{{ search_term }}": {{ results.count }}</h3>
<ul class="items venue">
	{% for venue in results.data %}
	<li>
		<a class="venue" href="/venues/{{ venue.id }}">
			<i class="fas fa-music"></i>
			<div class="item">
				<h5>{{ venue.name }}</h5>
			</div>
		</a>
		<a href="/venues/{{ venue.id }}/edit"><button class="btn btn-default btn-lg">Edit Venue</button></a>
		<button data-id="{{ venue.id }}" class="btn btn-default btn-lg delete_venue">Delete Venue</button>
	</li>
	{% endfor %}
</ul>
<script>
	/*delete venue*/
	const delete_venue = document.querySelectorAll('.delete_venue')
	for(let i = 0; i < delete_venue.length; i++){
		const delete_venue_button = delete_venue[i];
		delete_venue_button.onclick = function(e){
			const venueId = e.target.dataset['id'];
			console.log(venueId)
			fetch('/venues/' + venueId +'/delete',{
				method : 'delete',
			}).then(function(data){
				return data.json();
			}).then(function(jsonResponse){
				if(jsonResponse['success'] == '1'){
					console.log('success')
					window.location.href = "/";
				}
					// window.location.reload();
				else if(jsonResponse['success'] == '0')
					alert('Vebue could not be deleted!')
			})
		}
	}
</script>
{% endblock %}